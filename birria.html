<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Estad√≠sticas de Jugadores</title>
  <link rel="stylesheet" href="birria.css">
  <style>
    .navbar-item.borrar {
      color: red;
      margin-left: auto;
      cursor: pointer;
      font-weight: bold;
    }
  </style>
</head>

<body>

  <nav class="navbar">
    <div class="navbar-container">
      <a href="birria.html" class="navbar-item">Jugadores</a>
      <a href="estad.html" class="navbar-item">Agregar Estad√≠sticas</a>
      <span class="navbar-item borrar" onclick="confirmarReinicio()">Reiniciar TemporadaüóëÔ∏è</span>
    </div>
  </nav>

  <h1>Estad√≠sticas de Jugadores TEMPORADA 2025</h1>

  <div id="topPlayers" class="top-players">
    <h3>üèÖ L√≠deres del equipo</h3>
    <p><strong>ü•Ö M√°ximo goleador:</strong> <span id="topScorer"></span></p>
    <p><strong>üÖ∞Ô∏è M√°ximo asistidor:</strong> <span id="topAssists"></span></p>
    <p><strong>üèÜ M√°s veces MVP:</strong> <span id="topMVP"></span></p>
  </div>

  <div class="players" id="playerCards"></div>

  <!-- Modal -->
  <div id="modal" class="modal hidden">
    <div class="modal-content">
      <span class="close" onclick="closeModal()">&times;</span>
      <h2 id="modalTitle"></h2>
      <div id="modalBody"></div>
    </div>
  </div>

  <script>
    function loadData() {
      return JSON.parse(localStorage.getItem("jugadores")) || {};
    }

    function getTotal(stats) {
      let totalGoles = 0;
      let totalAsistencias = 0;
      let totalMVP = 0;

      for (const fecha in stats) {
        const entry = stats[fecha];
        totalGoles += entry.goles || 0;
        totalAsistencias += entry.asistencias || 0;

        const valorMVP = String(entry.jugadorDelPartido || '').trim().toLowerCase();
        if (valorMVP === 's√≠' || valorMVP === 'si' || valorMVP === 'true') {
          totalMVP++;
        }
      }

      return { totalGoles, totalAsistencias, totalMVP };
    }

    function renderPlayers() {
      const data = loadData();
      const container = document.getElementById("playerCards");
      const topScorer = document.getElementById("topScorer");
      const topAssists = document.getElementById("topAssists");
      const topMVP = document.getElementById("topMVP");

      container.innerHTML = '';

      let maxGoles = -1, maxAsistencias = -1, maxMVP = -1;
      let jugadorGoleador = '', jugadorAsistidor = '', jugadorMVP = '';

      Object.entries(data).forEach(([name, datos]) => {
        const { totalGoles, totalAsistencias, totalMVP } = getTotal(datos.fechas || {});

        if (totalGoles > maxGoles) {
          maxGoles = totalGoles;
          jugadorGoleador = name;
        }

        if (totalAsistencias > maxAsistencias) {
          maxAsistencias = totalAsistencias;
          jugadorAsistidor = name;
        }

        if (totalMVP > maxMVP) {
          maxMVP = totalMVP;
          jugadorMVP = name;
        }

        const fotoURL = datos.foto || 'https://via.placeholder.com/150'; // Imagen por defecto

        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
        <img src="${fotoURL}" alt="Foto de ${name}" style="width: 150px; height: 150px; object-fit: cover; border-radius: 10px; margin: 0 auto 10px auto; display: block;">
          <h3>${name}</h3>
          <p>Goles totales: ${totalGoles}</p>
          <p>Asistencias totales: ${totalAsistencias}</p>
          <p>MVP totales: ${totalMVP}</p>
        `;
        card.onclick = () => showDetails(name, datos.fechas || {});
        container.appendChild(card);
      });

      topScorer.textContent = jugadorGoleador ? `${jugadorGoleador} (${maxGoles} goles)` : 'N/A';
      topAssists.textContent = jugadorAsistidor ? `${jugadorAsistidor} (${maxAsistencias} asistencias)` : 'N/A';
      topMVP.textContent = jugadorMVP ? `${jugadorMVP} (${maxMVP} MVP)` : 'N/A';
    }

    function showDetails(name, fechas) {
      document.getElementById("modalTitle").textContent = `Detalles por fecha de ${name}`;
      const body = document.getElementById("modalBody");
      body.innerHTML = '';

      if (Object.keys(fechas).length === 0) {
        body.innerHTML = '<p>No hay datos registrados por fecha.</p>';
      } else {
        Object.entries(fechas).forEach(([fecha, stats]) => {
          let categoria = '';
          const goles = stats.goles || 0;
          if (goles === 2) categoria = ' (Doblete)';
          else if (goles === 3) categoria = ' (Hat-trick)';
          else if (goles === 4) categoria = ' (P√≥ker)';
          else if (goles === 5) categoria = ' (Rep√≥ker)';
          else if (goles > 5) categoria = ' (√âlite)';

          const valorMVP = String(stats.jugadorDelPartido || '').trim().toLowerCase();
          const isMVP = valorMVP === 's√≠' || valorMVP === 'si' || valorMVP === 'true';

          const div = document.createElement("div");
          div.innerHTML = `
            <strong>${fecha}</strong>
            <ul>
              <li>Goles: ${goles}${categoria}</li>
              <li>Asistencias: ${stats.asistencias || 0}</li>
              ${isMVP ? '<li><strong>üèÜ Jugador del Partido</strong></li>' : ''}
            </ul>
          `;
          body.appendChild(div);
        });
      }

      document.getElementById("modal").classList.remove("hidden");
    }

    function closeModal() {
      document.getElementById("modal").classList.add("hidden");
    }

    function borrarTodo() {
      if (confirm("¬øEst√°s seguro de que quieres borrar todos los datos? Esta acci√≥n no se puede deshacer.")) {
        localStorage.removeItem("jugadores");
        renderPlayers();
        alert("Datos eliminados correctamente.");
      }
    }

    renderPlayers();

    function confirmarReinicio() {
    const contrase√±a = prompt("Ingresa la contrase√±a para reiniciar la temporada:");
    const contrase√±aCorrecta = "12345"; // Cambia esto por la contrase√±a que quieras

    if (contrase√±a === contrase√±aCorrecta) {
      borrarTodo();
    } else {
      alert("Contrase√±a incorrecta. No se reinici√≥ la temporada.");
    }
  }

  function borrarTodo() {
    if (confirm("¬øEst√°s seguro de que quieres borrar todos los datos? Esta acci√≥n no se puede deshacer.")) {
      localStorage.removeItem("jugadores");
      renderPlayers();
      alert("Datos eliminados correctamente.");
    }
  }
  </script>

</body>
</html>
